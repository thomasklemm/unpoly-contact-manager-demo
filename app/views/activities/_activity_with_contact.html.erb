<%# up-expand delegates row clicks to the sr-only .activity-view-link inside,
    skipping any interactive child elements (contact link, delete button). %>
<div class="activity-item group cursor-pointer -mx-2 py-1 rounded-lg hover:bg-black/[0.03] transition-colors"
     up-expand=".activity-view-link">

  <div class="activity-dot flex items-center justify-center">
    <% case activity.kind %>
    <% when "call" %>
      <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.79 19.79 0 0 1 2.12 4.11 2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
    <% when "email" %>
      <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
    <% else %>
      <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg>
    <% end %>
  </div>

  <div class="pb-1 flex items-start gap-2">
    <div class="flex-1 min-w-0">
      <div class="flex items-baseline flex-wrap gap-x-1.5 gap-y-0.5 mb-0.5">
        <span class="text-xs font-semibold text-gray-600 capitalize"><%= activity.kind %></span>
        <span class="text-[11px] text-gray-400"><%= time_ago_in_words(activity.created_at) %> ago</span>
        <span class="text-[11px] text-gray-300">·</span>
        <%# Contact link — not intercepted by up-expand (interactive element) %>
        <%= link_to activity.contact.full_name,
              contact_path(activity.contact),
              "up-target"  => "#contact-detail",
              "up-history" => "true",
              class: "text-[11px] text-accent hover:text-accent-dark hover:underline font-medium transition-colors" %>
      </div>
      <p class="text-sm text-gray-600 leading-relaxed line-clamp-3"><%= activity.body %></p>

      <%# Primary link used by up-expand — visually hidden but accessible.
          up-on-accepted reloads #activities-list after overlay closes
          (covers both edit and delete from within the overlay). %>
      <%= link_to "View details",
            activity_path(activity),
            "data-overlay-link" => "",
            "up-history"        => "false",
            "up-on-accepted"    => "up.reload('#activities-list')",
            "up-on-dismissed"   => "up.reload('#activities-list')",
            class: "activity-view-link sr-only" %>
    </div>

    <%# Edit icon — shown on row hover only; interactive so up-expand skips it %>
    <%= link_to edit_activity_path(activity),
          "data-overlay-link" => "",
          "up-history"        => "false",
          "up-on-accepted"    => "up.reload('#activities-list')",
          "up-on-dismissed"   => "up.reload('#activities-list')",
          class: "flex-shrink-0 self-start mt-0.5 w-7 h-7 flex items-center justify-center rounded-md text-gray-400 hover:text-accent opacity-0 group-hover:opacity-100 transition-opacity",
          title: "Edit" do %>
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
    <% end %>

  </div>

</div>
