<div class="max-w-2xl mx-auto px-8 py-8">
  <%# Header: avatar + name + actions %>
  <div class="flex items-start gap-5 mb-8">
    <% hue = contact.id * 37 % 360 %>
    <div class="w-14 h-14 rounded-xl flex items-center justify-center text-white font-medium text-lg flex-shrink-0 shadow-md"
         style="background: hsl(<%= hue %>, 45%, 55%);">
      <%= contact.first_name[0].upcase %><%= contact.last_name[0].upcase %>
    </div>

    <div class="flex-1 min-w-0">
      <h2 class="font-display text-3xl text-gray-900 leading-tight"><%= contact.full_name %></h2>
      <% if contact.company %>
        <p class="mt-0.5 text-sm"><%= link_to contact.company.name, company_path(contact.company), "up-layer" => "new modal", class: "text-gray-500 hover:text-accent transition-colors" %></p>
      <% end %>
    </div>

    <div class="flex items-center gap-1.5 flex-shrink-0">
      <%# Star toggle — optimistic preview %>
      <%= button_to star_contact_path(contact), method: :patch,
            "up-target" => "#contact-detail",
            "up-on-finished" => "reloadContactsListPreservingScroll()",
            "up-preview" => "toggle-star",
            class: "star-icon #{contact.starred? ? 'starred' : 'unstarred'} w-9 h-9 flex items-center justify-center rounded-lg hover:bg-black/5 text-lg border-0 bg-transparent cursor-pointer transition-colors",
            title: contact.starred? ? "Unstar" : "Star" do %>
        <%= contact.starred? ? "★" : "☆" %>
      <% end %>

      <%# Edit — opens overlay (modal or drawer based on toggle) %>
      <%= link_to edit_contact_path(contact),
            "data-overlay-link" => "",
            "up-on-accepted" => "up.reload('#contact-detail'); reloadContactsListPreservingScroll()",
            class: "w-9 h-9 flex items-center justify-center rounded-lg hover:bg-black/5 text-gray-500 hover:text-gray-700 transition-colors",
            title: "Edit" do %>
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      <% end %>

      <%# Archive toggle — optimistic: fade row %>
      <%= button_to archive_contact_path(contact), method: :patch,
            "up-target" => "#contacts-list, #contact-detail",
            "up-preview" => "archive-contact",
            "up-confirm" => contact.archived? ? nil : "Archive #{contact.full_name}?",
            class: "w-9 h-9 flex items-center justify-center rounded-lg hover:bg-black/5 text-gray-500 hover:text-gray-700 border-0 bg-transparent cursor-pointer transition-colors",
            title: contact.archived? ? "Unarchive" : "Archive" do %>
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="21 8 21 21 3 21 3 8"/><rect x="1" y="3" width="22" height="5"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
      <% end %>

      <%# Delete with confirm %>
      <%= button_to contact_path(contact), method: :delete,
            "up-method" => "delete",
            "up-confirm" => "Delete #{contact.full_name}? This cannot be undone.",
            "up-target" => "#contacts-list, #contact-detail",
            "up-layer" => "root",
            class: "w-9 h-9 flex items-center justify-center rounded-lg hover:bg-red-50 text-gray-400 hover:text-red-600 border-0 bg-transparent cursor-pointer transition-colors",
            title: "Delete" do %>
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
      <% end %>
    </div>
  </div>

  <%# Archived badge %>
  <% if contact.archived? %>
    <div class="mb-6 px-4 py-2.5 bg-amber-50 border border-amber-200/60 rounded-xl text-amber-700 text-sm flex items-center gap-2">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="21 8 21 21 3 21 3 8"/><rect x="1" y="3" width="22" height="5"/></svg>
      Archived <%= time_ago_in_words(contact.archived_at) %> ago
    </div>
  <% end %>

  <%# Tags %>
  <% if contact.tags.any? %>
    <div class="flex flex-wrap gap-2 mb-6">
      <% contact.tags.each do |tag| %>
        <span class="tag-badge inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium text-white shadow-sm"
              style="background-color: <%= tag.color %>;">
          <%= tag.name %>
        </span>
      <% end %>
    </div>
  <% end %>

  <%# Contact info card %>
  <div class="bg-surface-raised rounded-xl border border-gray-200/60 p-5 mb-6 space-y-3.5 shadow-sm">
    <% if contact.email.blank? && contact.phone.blank? && contact.company&.website.blank? %>
      <p class="text-sm text-gray-400 text-center py-1">
        No contact details yet —
        <%= link_to "add some", edit_contact_path(contact),
              "data-overlay-link" => "",
              "up-on-accepted" => "up.reload('#contact-detail'); reloadContactsListPreservingScroll()",
              class: "text-accent hover:underline" %>
      </p>
    <% end %>
    <% if contact.email.present? %>
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-lg bg-surface-muted flex items-center justify-center flex-shrink-0">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        </div>
        <a href="mailto:<%= contact.email %>" class="text-sm text-gray-700 hover:text-accent transition-colors"><%= contact.email %></a>
      </div>
    <% end %>
    <% if contact.phone.present? %>
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-lg bg-surface-muted flex items-center justify-center flex-shrink-0">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
        </div>
        <a href="tel:<%= contact.phone %>" class="text-sm text-gray-700 hover:text-accent transition-colors"><%= contact.phone %></a>
      </div>
    <% end %>
    <% if contact.company&.website.present? %>
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-lg bg-surface-muted flex items-center justify-center flex-shrink-0">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
        </div>
        <a href="<%= contact.company.website %>" target="_blank" rel="noopener"
           class="text-sm text-gray-700 hover:text-accent transition-colors truncate"><%= contact.company.website %></a>
      </div>
    <% end %>
  </div>

  <%# Notes %>
  <% if contact.notes.present? %>
    <div class="mb-6">
      <h3 class="text-[11px] font-semibold text-gray-400 uppercase tracking-widest mb-2">Notes</h3>
      <p class="text-sm text-gray-600 whitespace-pre-line leading-relaxed"><%= contact.notes %></p>
    </div>
  <% end %>

  <%# Activities — lazy loaded via up-defer %>
  <div>
    <h3 class="text-[11px] font-semibold text-gray-400 uppercase tracking-widest mb-4">Activity</h3>
    <%# up-defer fetches the URL and replaces this element with #activities-panel from the response %>
    <div id="activities-panel" up-defer up-href="<%= contact_activities_path(contact) %>">
      <div class="flex items-center gap-2 text-sm text-gray-400">
        <div class="w-4 h-4 rounded-full border-2 border-gray-300 border-t-transparent animate-spin"></div>
        Loading activity...
      </div>
    </div>
  </div>
</div>
