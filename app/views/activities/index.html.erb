<%# Lazy-loaded via up-defer â€” id must match the placeholder in _contact_detail %>
<div id="activities-panel">

  <%# Inline form to add a new activity %>
  <div class="mb-6">
    <%= form_with model: [ @contact, @activity ],
          class: "space-y-2",
          html: { "up-target" => "#activities-panel" } do |f| %>

      <div class="flex gap-2">
        <%= f.select :kind, Activity::KINDS.map { |k| [ k.capitalize, k ] },
              {},
              class: "form-input px-3 py-2 text-sm border border-gray-200 rounded-lg bg-surface-raised" %>
        <%= f.text_field :body, placeholder: "Add a note, log a call...",
              autocomplete: "off",
              class: "form-input flex-1 px-3 py-2 text-sm border border-gray-200 rounded-lg bg-surface-raised" %>
        <%= f.submit "Add",
              class: "px-4 py-2 text-sm font-medium text-white bg-accent rounded-lg hover:bg-accent-dark cursor-pointer transition-colors shadow-sm" %>
      </div>

      <% if @activity.errors[:body].any? %>
        <p class="text-xs text-red-600"><%= @activity.errors[:body].first %></p>
      <% end %>
    <% end %>
  </div>

  <%# Activity timeline %>
  <% if @activities.empty? %>
    <p class="text-sm text-gray-400 text-center py-6">No activity yet</p>
  <% else %>
    <div class="space-y-4">
      <% @activities.each do |activity| %>
        <%= render 'activities/activity', activity: activity %>
      <% end %>
    </div>
  <% end %>

</div>
