<div class="p-6 max-w-2xl mx-auto">
  <%# Header: name + actions %>
  <div class="flex items-start justify-between mb-6">
    <div>
      <h2 class="text-2xl font-bold text-gray-900"><%= contact.full_name %></h2>
      <% if contact.company %>
        <p class="text-gray-500 mt-0.5"><%= contact.company.name %></p>
      <% end %>
    </div>

    <div class="flex items-center gap-2 flex-shrink-0">
      <%# Star toggle ‚Äî optimistic preview %>
      <%= button_to star_contact_path(contact), method: :patch,
            "up-target" => "#contact-detail",
            "up-preview" => "toggle-star",
            class: "star-icon #{contact.starred? ? 'starred' : 'unstarred'} p-2 rounded-lg hover:bg-gray-100 text-xl border-0 bg-transparent cursor-pointer",
            title: contact.starred? ? "Unstar" : "Star" do %>
        <%= contact.starred? ? "‚òÖ" : "‚òÜ" %>
      <% end %>

      <%# Edit ‚Äî opens modal %>
      <%= link_to "Edit", edit_contact_path(contact),
            "up-layer" => "new modal",
            "up-on-accepted" => "up.reload('#contact-detail')",
            class: "px-3 py-1.5 text-sm font-medium bg-white border border-gray-300 rounded-lg hover:bg-gray-50" %>

      <%# Archive toggle ‚Äî optimistic: fade row %>
      <%= button_to archive_contact_path(contact), method: :patch,
            "up-target" => "#contacts-list, #contact-detail",
            "up-preview" => "archive-contact",
            "up-confirm" => contact.archived? ? nil : "Archive #{contact.full_name}?",
            class: "px-3 py-1.5 text-sm font-medium bg-white border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer" do %>
        <%= contact.archived? ? "Unarchive" : "Archive" %>
      <% end %>

      <%# Delete with confirm %>
      <%= button_to contact_path(contact), method: :delete,
            "up-method" => "delete",
            "up-confirm" => "Delete #{contact.full_name}? This cannot be undone.",
            "up-target" => "#contacts-list",
            "up-layer" => "root",
            class: "px-3 py-1.5 text-sm font-medium bg-red-50 border border-red-200 text-red-700 rounded-lg hover:bg-red-100 cursor-pointer" do %>
        Delete
      <% end %>
    </div>
  </div>

  <%# Tags %>
  <% if contact.tags.any? %>
    <div class="flex flex-wrap gap-2 mb-5">
      <% contact.tags.each do |tag| %>
        <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium text-white"
              style="background-color: <%= tag.color %>;">
          <%= tag.name %>
        </span>
      <% end %>
    </div>
  <% end %>

  <%# Contact info grid %>
  <div class="bg-gray-50 rounded-xl p-4 mb-5 space-y-3">
    <% if contact.email.present? %>
      <div class="flex items-center gap-3">
        <span class="text-gray-400 w-5 text-center">‚úâÔ∏è</span>
        <a href="mailto:<%= contact.email %>" class="text-blue-600 hover:underline"><%= contact.email %></a>
      </div>
    <% end %>
    <% if contact.phone.present? %>
      <div class="flex items-center gap-3">
        <span class="text-gray-400 w-5 text-center">üìû</span>
        <a href="tel:<%= contact.phone %>" class="text-blue-600 hover:underline"><%= contact.phone %></a>
      </div>
    <% end %>
    <% if contact.company&.website.present? %>
      <div class="flex items-center gap-3">
        <span class="text-gray-400 w-5 text-center">üåê</span>
        <a href="<%= contact.company.website %>" target="_blank" rel="noopener"
           class="text-blue-600 hover:underline truncate"><%= contact.company.website %></a>
      </div>
    <% end %>
  </div>

  <%# Notes %>
  <% if contact.notes.present? %>
    <div class="mb-5">
      <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Notes</h3>
      <p class="text-gray-700 text-sm whitespace-pre-line"><%= contact.notes %></p>
    </div>
  <% end %>

  <%# Archived badge %>
  <% if contact.archived? %>
    <div class="mb-4 px-3 py-2 bg-amber-50 border border-amber-200 rounded-lg text-amber-700 text-sm">
      Archived <%= time_ago_in_words(contact.archived_at) %> ago
    </div>
  <% end %>

  <%# Activities ‚Äî lazy loaded via up-defer %>
  <div>
    <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">Activity</h3>
    <%# up-defer fetches the URL and replaces this element with #activities-panel from the response %>
    <div id="activities-panel" up-defer="<%= contact_activities_path(contact) %>">
      <div class="text-sm text-gray-400 animate-pulse">Loading activity‚Ä¶</div>
    </div>
  </div>
</div>
