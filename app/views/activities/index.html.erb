<%# Lazy-loaded via up-defer — id must match the placeholder in _contact_detail %>
<div id="activities-panel">

  <%# Inline form to add a new activity %>
  <div class="mb-4">
    <%= form_with model: [ @contact, @activity ],
          "up-target" => "#activities-panel",
          class: "space-y-2" do |f| %>

      <div class="flex gap-2">
        <%= f.select :kind, Activity::KINDS.map { |k| [ k.capitalize, k ] },
              {},
              class: "px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" %>
        <%= f.text_field :body, placeholder: "Add a note, log a call…",
              autocomplete: "off",
              class: "flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" %>
        <%= f.submit "Add",
              class: "px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 cursor-pointer" %>
      </div>

      <% if @activity.errors[:body].any? %>
        <p class="text-xs text-red-600"><%= @activity.errors[:body].first %></p>
      <% end %>
    <% end %>
  </div>

  <%# Activity timeline %>
  <% if @activities.empty? %>
    <p class="text-sm text-gray-400 text-center py-4">No activity yet</p>
  <% else %>
    <div class="space-y-3">
      <% @activities.each do |activity| %>
        <%= render 'activities/activity', activity: activity %>
      <% end %>
    </div>
  <% end %>

</div>
