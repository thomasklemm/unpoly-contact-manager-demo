<%# Lazy-loaded via up-defer â€” id must match the placeholder in _contact_detail %>
<div id="activities-panel">

  <%# Inline form to add a new activity %>
  <div class="mb-6 bg-surface-raised rounded-xl border border-gray-200/60 p-4">
    <%= form_with model: [ @contact, @activity ],
          html: { "up-target" => "#activities-panel" },
          class: "space-y-3" do |f| %>

      <%# Activity kind segmented control %>
      <div class="flex gap-1 p-1 bg-surface-muted rounded-lg mb-3" id="activity-kind-selector">
        <% Activity::KINDS.each do |kind| %>
          <button type="button"
                  data-kind="<%= kind %>"
                  class="kind-btn flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-md transition-all text-gray-500 hover:text-gray-700">
            <%= kind == 'note' ? 'ðŸ“' : kind == 'call' ? 'ðŸ“ž' : 'âœ‰ï¸' %>
            <%= kind.capitalize %>
          </button>
        <% end %>
      </div>
      <%= f.hidden_field :kind, value: "note" %>

      <%# Body textarea (full width) %>
      <%= f.text_area :body, placeholder: "Add a note, log a call, record an email...",
            rows: 3,
            autocomplete: "off",
            class: "form-input w-full px-3 py-2 text-sm border border-gray-200 rounded-lg bg-surface-raised resize-none" %>
      <% if @activity.errors[:body].any? %>
        <p class="text-xs text-red-600 mt-1"><%= @activity.errors[:body].first %></p>
      <% end %>

      <div class="flex justify-end mt-2">
        <%= f.submit "Add",
              class: "px-4 py-2 text-sm font-medium text-white bg-accent rounded-lg hover:bg-accent-dark cursor-pointer transition-colors shadow-sm" %>
      </div>
    <% end %>
  </div>

  <%# Activity timeline %>
  <% if @activities.empty? %>
    <p class="text-sm text-gray-400 text-center py-6">No activity yet</p>
  <% else %>
    <div class="space-y-4">
      <% @activities.each do |activity| %>
        <%= render 'activities/activity', activity: activity %>
      <% end %>
    </div>
  <% end %>

</div>
