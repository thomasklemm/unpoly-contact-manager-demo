<% if up.layer.overlay? %>
  <%# Unpoly overlay request (modal) — render just the content fragment %>
  <div class="p-6" up-main>
    <h2 class="font-display text-3xl text-gray-900 leading-tight"><%= @company.name %></h2>

    <% if @company.website.present? %>
      <p class="mt-1">
        <a href="<%= @company.website %>" target="_blank" rel="noopener"
           class="text-sm text-accent hover:text-accent-dark transition-colors"><%= @company.website %></a>
      </p>
    <% end %>

    <p class="text-sm text-gray-500 mt-2"><%= pluralize(@company_contacts.count, 'contact') %></p>

    <% if @company_contacts.any? %>
      <div class="mt-6 space-y-2">
        <% @company_contacts.each do |contact| %>
          <%= link_to contact_path(contact),
                "up-target" => "#contact-detail",
                "up-layer" => "root",
                class: "block p-3 rounded-lg bg-surface-raised border border-gray-200/60 hover:border-accent/30 transition-colors" do %>
            <p class="text-sm font-medium text-gray-900"><%= contact.full_name %></p>
            <p class="text-xs text-gray-500 mt-0.5"><%= contact.email %></p>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
<% else %>
  <%# Direct navigation — render full two-panel layout %>
  <%= render 'contacts/sidebar' %>
  <div id="contact-detail" up-main>
    <div class="max-w-2xl mx-auto px-8 py-8">
      <%= link_to companies_path,
            "up-target" => "#contact-detail",
            class: "inline-flex items-center gap-1 text-xs text-gray-400 hover:text-accent transition-colors mb-5" do %>
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="15 18 9 12 15 6"/></svg>
        Companies
      <% end %>
      <div class="mb-6">
        <h2 class="font-display text-3xl text-gray-900 leading-tight"><%= @company.name %></h2>
        <% if @company.website.present? %>
          <p class="mt-1">
            <a href="<%= @company.website %>" target="_blank" rel="noopener"
               class="text-sm text-accent hover:text-accent-dark transition-colors"><%= @company.website %></a>
          </p>
        <% end %>
        <p class="text-sm text-gray-500 mt-2"><%= pluralize(@company_contacts.count, 'contact') %></p>
      </div>

      <% if @company_contacts.any? %>
        <div class="space-y-2">
          <% @company_contacts.each do |contact| %>
            <%= link_to contact_path(contact),
                  "up-target" => "#contact-detail",
                  class: "block p-3 rounded-lg bg-white border border-gray-200/60 hover:border-accent/30 transition-colors" do %>
              <p class="text-sm font-medium text-gray-900"><%= contact.full_name %></p>
              <p class="text-xs text-gray-500 mt-0.5"><%= contact.email %></p>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
